{% extends "templates/base.html" %}
{% block content %}
<h1>Add Geocode</h1>

{% if success %}
Succeeded!

<p>lat: {{lat}}</p>
<p>long: {{long}}</p>
{% endif %}


<form id="form" action="/addgeocode" method="post">
	Partner Name:<input name="partner_name">
	<input id="_postcode" name="postcode" hidden>
	<input id="lat" name="lat" hidden>
	<input id="long" name="long" hidden>
</form>

<form onsubmit="return try_submit();">
	Postcode:
	<input class="collectionform input-lg" type="text" id="postcode" name="postcode"
	placeholder="What's Your Postcode?">

	<br>
	<br>
	<input id="searchbutton" type="submit" class="btn btn-success" value="Add geocode">
</form>



{% endblock %}


{% block endscripts %}

<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

<script>

function try_submit()
    {
    	$("#searchbutton").val("Finding...");
        $("#_postcode").val($("#postcode").val())
      
        var geocoder = new google.maps.Geocoder();

        geocoder.geocode({address: $("#postcode").val() + ", UK"}, function(results, status) {
				if (results[0])
				{
					var postcode = $("#postcode").val();
					var result = results[0];
					$("#lat").val(result.geometry.location.lat());
					$("#long").val(result.geometry.location.lng());
					$("#form").submit()
				}
		})
      return false;
	}

</script>

{% endblock %}